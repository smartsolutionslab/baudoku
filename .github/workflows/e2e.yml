name: E2E Tests

on:
  workflow_dispatch:
  schedule:
    - cron: '0 4 * * 1-5' # Weekdays at 4 AM UTC

permissions:
  contents: read

jobs:
  e2e-android:
    name: E2E Tests (Android)
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
          cache-dependency-path: src/frontend/package-lock.json

      - name: Install frontend dependencies
        working-directory: src/frontend
        run: npm ci

      - name: Install Maestro
        run: |
          curl -Ls "https://get.maestro.mobile.dev" | bash
          echo "$HOME/.maestro/bin" >> $GITHUB_PATH

      - name: Run Maestro flows
        run: |
          echo "E2E tests are placeholder â€” real flows will be added as app UI stabilizes"
          maestro test e2e/flows/ || true

      - name: Upload test results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-results
          path: ~/.maestro/tests/
          retention-days: 14
